langcode: en
status: true
dependencies: {  }
id: pregens
migration_tags: null
migration_group: eldrich_chars
label: 'Pregen Characters'
source:
  plugin: csv
  path: modules/custom/ep_import/characters/pregens.csv
  header_row_count: 1
  column_names:
    -
      name: name
    -
      based_on: based_on
    -
      book: book
    -
      background: background
    -
      faction: faction
    -
      motivations: motivations
    -
      quote: quote
    -
      description: description
    -
      ego_stats: ego_stats
    -
      skills: skills
    -
      morph: morph
    -
      morph_stats: morph_stats
    -
      augmentations: augmentations
    -
      traits: traits
    -
      sleights: sleights
    -
      gear: gear
    -
      blueprints: blueprints
    -
      weapons: weapons
    -
      armor: armor
    -
      credits: credits
    -
      rep: rep
  keys:
    - name
process:
  title: name
  type:
    plugin: default_value
    default_value: pc
  field_description/value: description
  field_quote/value: quote
  field_stats:
    plugin: stat_block
    source: stats
  field_skills:
    -
      plugin: skip_on_empty
      method: process
      source: skills
    -
      plugin: explode
      delimiter: ','
    -
      plugin: skill_lookup
      destination_field: target_id
      entity_type: node
      bundle: skill
      bundle_key: type
      value_key: title
  field_gear:
    -
      plugin: skip_on_empty
      method: process
      source: gear
    -
      plugin: explode
      delimiter: ','
    -
      plugin: entity_lookup_plus
      destination_field: target_id
      value_key: title
      fallback_value_key: field_short_name
      bundle_key: type
      entity_type: node
      bundle:
        - gear
        - weapon
        - armor
        - drug
        - vehicle
        - robot
        - mind
  field_blueprints:
    -
      plugin: skip_on_empty
      method: process
      source: blueprints
    -
      plugin: explode
      delimiter: ','
    -
      plugin: entity_lookup_plus
      destination_field: target_id
      value_key: title
      fallback_value_key: field_short_name
      bundle_key: type
      entity_type: node
      bundle:
        - gear
        - weapon
        - armor
        - drug
        - vehicle
        - robot
  field_traits:
    -
      plugin: skip_on_empty
      method: process
      source: traits
    -
      plugin: explode
      delimiter: ','
    -
      plugin: entity_lookup_plus
      destination_field: target_id
      value_key: title
      bundle: trait
      bundle_key: type
      entity_type: node
  field_sleights:
    -
      plugin: skip_on_empty
      method: process
      source: sleights
    -
      plugin: explode
      delimiter: ','
    -
      plugin: entity_lookup_plus
      destination_field: target_id
      value_key: title
      bundle: sleight
      bundle_key: type
      entity_type: node
  field_morph/target_id:
    -
      plugin: skip_on_empty
      method: process
      source: morph
    -
      plugin: entity_maker
      entity_type: instance
      source:
        - morph
        - traits
        - augmentations
      keys:
        - morph
        - traits
        - augmentations
      default_values:
        type: morph
      process:
        field_model:
          plugin: entity_lookup_plus
          value_key: title
          bundle: morph
          bundle_key: type
          entity_type: node
          source: morph
        field_traits:
          -
            plugin: skip_on_empty
            method: process
            source: traits
          -
            plugin: explode
            delimiter: ','
          -
            plugin: entity_lookup_plus
            destination_field: target_id
            value_key: title
            bundle: trait
            bundle_key: type
            entity_type: node
        field_augmentations:
          -
            plugin: skip_on_empty
            method: process
            source: augmentations
          -
            plugin: explode
            delimiter: ','
          -
            plugin: entity_lookup_plus
            destination_field: target_id
            value_key: title
            bundle: augmentation
            bundle_key: type
            entity_type: node
  field_identity/target_id:
    plugin: entity_maker
    entity_type: component
    source:
      - name
      - faction
      - background
      - rep
      - credits
    keys:
      - name
      - faction
      - background
      - rep
      - credits
    default_values:
      type: identity
    process:
      title: name
      field_credits: credits
      field_background: background
      field_rep:
        -
          plugin: skip_on_empty
          method: process
          source: rep
        -
          plugin: explode
          delimiter: ','
        -
          plugin: entity_lookup_plus
          delimiter: ':'
          extra_value_key: quantity
          value_key: field_code
          bundle: network
          bundle_key: type
          entity_type: node
      field_faction:
        plugin: entity_lookup_plus
        value_key: title
        bundle: faction
        bundle_key: type
        entity_type: node
        source: faction
  field_equipped_weapons:
    plugin: equipped_weapon
    source: weapons
  field_equipped_armor:
    plugin: equipped_armor
    source: armor
  field_attribution:
    plugin: entity_maker
    entity_type: component
    source:
      - book
    keys:
      - book
    default_values:
      type: attribution
    process:
      field_attribution_citations:
        plugin: source_with_page
        entity_type: node
        bundle: source
        bundle_key: type
        value_key: field_code
        source: book
destination:
  plugin: 'entity:node'
migration_dependencies: null

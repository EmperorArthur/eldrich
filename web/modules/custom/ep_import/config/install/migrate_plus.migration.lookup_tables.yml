id: lookup_tables
migration_group: eldrich
label: 'Basic lookup tables for other content types'

source:
  plugin: csv
  path: 'modules/custom/ep_import/data/data-tables.csv'
  header_row_count: 1

  # Columns to be returned, basically a list of table header cell values.
  column_names:
    0:
      title: Title
    1:
      code: Code
    2:
      table: Table
    3:
      type: Type
    4:
      weight: Weight
    5:
      description: Description
    6:
      speed: Speed
  keys:
    - title
    - table
  constants:
    format: basic_html

destination:
  plugin: 'entity:lookup'

process:
  type: table

  title: title

  field_code:
    plugin: skip_on_empty
    method: process
    source: code

  field_type:
    plugin: skip_on_empty
    method: process
    source: type

  field_weight:
    plugin: skip_on_empty
    method: process
    source: weight


  speed_array:
    -
      plugin: skip_on_empty
      method: process
      source: speed
    -
      plugin: explode
      source: some_text_field
      delimiter: '/'

  'field_speed/walk':
    -
      plugin: skip_on_empty
      method: process
      source: '@speed_array'
    -
      plugin: extract
      index: 0

  'field_speed/run':
    -
      plugin: skip_on_empty
      method: process
      source: '@speed_array'
    -
      plugin: extract
      index: 1

  'field_speed/cruise':
    -
      plugin: skip_on_empty
      method: process
      source: '@speed_array'
    -
      plugin: extract
      index: 2

  'field_description/value':
    plugin: skip_on_empty
    method: process
    source: description
